name: Production Deploy

on:
  push:
    branches: [ "main" ]

jobs:
  deploy:
    name: Deploy to Production
    runs-on: self-hosted
    
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
        
      - name: Setup Docker Buildx
        uses: docker/setup-buildx-action@v3
        
      - name: Deploy with Docker Compose
        run: |
          echo "ğŸš€ Starting Deployment..."
          
          # Pull latest changes (implicit in checkout) and build
          # Using 'docker compose' (v2). If your server uses v1, change to 'docker-compose'
          
          echo "â¬‡ï¸  Stopping containers..."
          docker-compose down --remove-orphans || true
          
          echo "ğŸ—ï¸  Building and Starting..."
          docker-compose up -d --build
          
          echo "ğŸ§¹ Pruning unused images..."
          docker image prune -f
          
          echo "âœ… Deployment Complete!"
